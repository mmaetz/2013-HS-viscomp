\chapter{Transformations}
\begin{enumerate*}[label=\protect\circled{\arabic*},itemjoin=]
	\item Change position and orientation of objects\\
	\item Project objects to screet\\
	\item Animate objcets
\end{enumerate*}
\section{Notation}
Points and vectors are represented as
\begin{gather*}
	\vtr{p}=
	\!\left(\!\begin{smallmatrix}
		x\\
		y
	\end{smallmatrix}\!\right)\!
\end{gather*}
Matrices are represented as $A$, a point is transformed as 
\begin{align*}
\vtr{p}'&=A\vtr{p}, 
\shortintertext{transpose: }
	\vtr{p}^T&=(x,y),\\
	{\!\left(\! \vtr{A}^T\! \right)\!}_{ij}&=\vtr{A}_{ji},
	\shortintertext{linear maps}
	A(\alpha x+\beta y)&=\alpha A(x)+\beta A(y),\\
	\shortintertext{represented by matrices}
	\vtr{A}(\alpha \vtr{x}+\beta y)&= \alpha \vtr{A}\vtr{x}+\beta \vtr{A}\vtr{y}
	\shortintertext{affine maps}
	\vtr{A}\vtr{x}+\vtr{b}&=\vtr{x}'.
	\shortintertext{translation}
	\!\left(\!\begin{smallmatrix}
		x'\\
		y'
	\end{smallmatrix}\!\right)\!
	&=
	\!\left(\!\begin{smallmatrix}
		x\\
		y
	\end{smallmatrix}\!\right)\!
	+\!\left(\!\begin{smallmatrix}
		t_x\\
		t_y
	\end{smallmatrix}\!\right)\!,
	\\
	\leadsto \vtr{p}'&=\vtr{p}+\vtr{t}\\
	\shortintertext{scaling}
	\!\left(\!\begin{smallmatrix}
		x'\\
		y'
	\end{smallmatrix}\!\right)\!
	&=
	\!\left(\!\begin{smallmatrix}
		s_x&0\\
		0&s_y
	\end{smallmatrix}\!\right)\!
	\!\left(\!\begin{smallmatrix}
		x\\
		y
	\end{smallmatrix}\!\right)\!,
	\\
	\vtr{p}'&=\vtr{S}\vtr{p},
	\shortintertext{rotation by angle $\theta$}
	\!\left(\!\begin{smallmatrix}
		x'\\
		y'
	\end{smallmatrix}\!\right)\!
	&=
	\!\left(\!\begin{smallmatrix}
		\cos\theta&-\sin\theta\\
		\sin\theta&\cos\theta
	\end{smallmatrix}\!\right)\!
	\!\left(\!\begin{smallmatrix}
		x\\
		y
	\end{smallmatrix}\!\right)\!\\
	\leadsto \vtr{p}'&= \vtr{R}\vtr{p}
\end{align*}
\section{2D Transformations}
\begin{compactdesc}
\item[\lp{Homogeneous transformations}] 
Affine maps are linear maps in \emph{homogeneous coordinates}
\begin{align*}
	\vtr{p}&=
	\!\left(\!\begin{smallmatrix}
		x\\
		y\\
		1
	\end{smallmatrix}\!\right)\!,
	\shortintertext{translation is represented as a matrix}
	\!\left(\!\begin{smallmatrix}
		x'\\
		y'\\
		1
	\end{smallmatrix}\!\right)\!
	&=
	\!\left(\!\begin{smallmatrix}
		1&0&t_x\\
		0&1&t_y\\
		0&0&1
	\end{smallmatrix}\!\right)\!
	\!\left(\!\begin{smallmatrix}
		x\\
		y\\
		1
	\end{smallmatrix}\!\right)\!,\\
	\vtr{p}'&=\vtr{T}\vtr{p},
	\shortintertext{rotation}
	\vtr{R}&=
	\!\left(\!\begin{smallmatrix}
		\cos\theta&-\sin\theta&0\\
		\sin\theta&\cos\theta&0\\
		0&0&1
	\end{smallmatrix}\!\right)\!,\\
	\vtr{S}&=
	\!\left(\!\begin{smallmatrix}
		s_x&0&0\\
		0&s_y&0\\
		0&0&1
	\end{smallmatrix}\!\right)\!,
	\shortintertext{shear along $x$- and $y$- axis (entlang der $x$- oder $y$- Achse strecken)}
	\vtr{SH}_x&=
	\!\left(\!\begin{smallmatrix}
		1&a&0\\
		0&1&0\\
		0&0&1
	\end{smallmatrix}\!\right)\!
	\\
	\vtr{SH}&=
	\!\left(\!\begin{smallmatrix}
		1&0&0\\
		b&1&0\\
		0&0&1
	\end{smallmatrix}\!\right)\!
	\shortintertext{A point has infinitely many homogeneous coordinates, for any $w$}
	\vtr{p}&=
	\!\left(\!\begin{smallmatrix}
		wx\\
		wy\\
		w
	\end{smallmatrix}\!\right)\!,\\
	\shortintertext{Combined rotation and translation}
	\vtr{T}\vtr{R}&=
	\!\left(\!\begin{smallmatrix}
		r_{11}&r_{12}&t_x\\
		r_{21}&r_{22}&t_y\\
		0&0&1
	\end{smallmatrix}\!\right)\!
	\shortintertext{commutativity}
	\vtr{M}_1\vtr{M}_2&=\vtr{M}_2\vtr{M}_1
	\shortintertext{For pairs $(M_1,M_2)=$ $(\vtr{T},\vtr{T})$, $(\vtr{R},\vtr{R})$, $(\vtr{S},\vtr{S})$, $(\vtr{S},\vtr{R})$, only for 2D!}
\end{align*}
\section{3D Transformations}
\item[\lp{Homogeneous coordinates}] $4\times 4$ matrices. Project 
	\begin{gather*}
		\vtr{p}=
		\!\left(\!\begin{smallmatrix}
			x\\
			y\\
			z\\
			w
		\end{smallmatrix}\!\right)\!
		\quad\text{onto hyperplane}\quad
		\!\left(\!\begin{smallmatrix}
			x/w\\y/w\\z/w\\1
		\end{smallmatrix}\!\right)\!
	\end{gather*}
	\begin{flalign*}
		\text{Translation}&&\text{Scaling}\\
		\!\left(\!\begin{smallmatrix}
			1&0&0&t_x\\
			0&1&0&t_y\\
			0&0&1&t_z\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!
		&&
		\!\left(\!\begin{smallmatrix}
			s_x&0&0&0\\
			0&s_y&0&0\\
			0&0&s_z&0\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!
	\end{flalign*}
	For following equations, use 
	\begin{align*}
		s_{\theta}&\coloneqq \sin\theta,&c_{\theta}&\coloneqq\cos\theta.
	\end{align*}
	Rotation around the $x$-,$y$-,$z$-axis
	\begin{align*}
		\vtr{R}_x&=\!\left(\!\begin{smallmatrix}
			1&0&0&0\\
			0&c_{\theta}&-s_{\theta}&0\\
			0&s_{\theta}&c_{\theta}&0\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!,\\
		\vtr{R}_y&=
		\!\left(\!\begin{smallmatrix}
			c_{\theta}&0&s_{\theta}&0\\
			0&1&0&0\\
			-s_{\theta}&0&c_{\theta}&0\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!,\\
		\vtr{R}_z&=
		\!\left(\!\begin{smallmatrix}
			c_{\theta}&-s_{\theta}&0&0\\
			s_{\theta}&c_{\theta}&0&0\\
			0&0&1&0\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!.
	\end{align*}
\begin{sideways}
	\begin{minipage}[t]{2.2\columnwidth}
	Rotation of angle $\theta$ around an axis $\vtr{u}$
		\begin{align*}
			&\vtr{R}'(\vtr{u},\theta)=\\
				&\begin{bmatrix}
					u_{x}^{2}+c_{\theta}\!\left( 1-u_{x}^{2} \right)\!&u_xu_y\!\left( 1-c_{\theta} \right)\!-u_zs_{\theta}&u_xu_z\!\left( 1-c_{\theta} \right)\!-u_{y}s_{\theta}\\
					u_xu_y\!\left( 1-c_{\theta} \right)\!-u_zs_{\theta}&u_{y}^{2}+c_{\theta}\!\left( 1-u_{y}^{2} \right)\!&u_yu_z\!\left( 1-c_{\theta} \right)\!-u_xs_{\theta}\\
					u_xu_z\!\left( 1-c_{\theta} \right)\!-u_{y}s_{\theta}&u_yu_z\!\left( 1-c_{\theta} \right)\!-u_xs_{\theta}&u_{z}^{2}+c_{\theta}\!\left( 1-u_{z}^{2} \right)\!\\
				\end{bmatrix},\\
				&\vtr{R}(\vtr{u},\theta)=
				\!\left(\!\begin{smallmatrix}
					&&&0\\
					&\vtr{R}'&&0\\
					&&&0\\
					0&0&0&1
				\end{smallmatrix}\!\right)\!.
		\end{align*}
	\end{minipage}
\end{sideways}
Shearing paralles to the principal planes.
	\begin{align*}
		\vtr{SH}_{xy}&=
		\!\left(\!\begin{smallmatrix}
			1&0&sh_x&\\
			0&1&sh_y&0\\
			0&0&1&0\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!\\
		\vtr{SH}_{xz}&=
		\!\left(\!\begin{smallmatrix}
			1&sh_x&0&0\\
			0&1&0&0\\
			0&sh_z&1&0\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!\\
		\vtr{SH}_{yz}&=
		\!\left(\!\begin{smallmatrix}
			1&0&0&0\\
			sh_y&1&0&0\\
			sh_z&0&1&0\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!
	\end{align*}
	\section{Coordinate Systems}
	Represent a point/vector as a linear combination of orthonormal basis vectors
	\begin{align}
		\vtr{p}&=p_x\vtr{x}+p_y\vtr{y}+p_z\vtr{z}\nonumber
		\shortintertext{change of coordinate systems}\nonumber
		\vtr{p}'&=
		\!\left(\!\begin{smallmatrix}
			\vtr{r}_1&\vtr{r}_2&\vtr{r}_3&\vtr{t}\\
			0&0&0&1\\
		\end{smallmatrix}\!\right)\!
		\!\left(\!\begin{smallmatrix}
			p_x\\
			p_y\\
			p_z\\
			1
		\end{smallmatrix}\!\right)\!\\
		&=
		\!\left(\!\begin{smallmatrix}
			\vtr{t}+p_x\vtr{r}_1+p_y\vtr{r}_2+p_z\vtr{r}_3\\
			1
		\end{smallmatrix}\!\right)\!
		\label{eq:coordtrafo}
	\end{align}
\item[\lp{transform normal vectors}]
	\begin{align*}
		\vtr{p}'&=\vtr{M}\vtr{p}
		\shortintertext{each}
		\vtr{p}&=(x,y,z,1)
		\shortintertext{on the plane satisfies}
		Ax+By+Cz+D&=0
		\shortintertext{Then the normal is given by}
		\vtr{n}&=
		\!\left(\!\begin{smallmatrix}
			A&B&C&D
		\end{smallmatrix}\!\right)\!
		\shortintertext{transformed normal}
		\vtr{n}'&={\!\left(\!\vtr{M}^{-1}\!  \right)\!}^{-T}\vtr{n}
		\shortintertext{the plane is given by}
		\vtr{n}^{T}\vtr{p}&=0
	\end{align*}
	\section{Projection}
	From 3D to 2D space.
\item[\lp{Parallel projection}]\hfill\\
	\pgr{2-2_Transformations}{33}{-2.8}{-0.9}{0}{0.8}
\item[\lp{Perspective projection}]\hfill\\
	\pgr{2-2_Transformations}{33}{0}{-0.9}{2.8}{0.8}
\item[\lp{Vanishing points}]\hfill\\
	\pgr{2-2_Transformations}{35}{-0.3}{-1.3}{2.5}{1.0}
\item[\lp{Mathematics of perspective projection}]\hfill\\
	\pgr{2-2_Transformations}{36}{-1.0}{-0.4}{1.0}{0.6}
	\begin{align*}
		x_p&=d\frac{x}{z},\\
		y_p&=d\frac{y}{z},\\
		\vtr{M}_{\text{per}}
		&=
		\!\left(\!\begin{smallmatrix}
			1&0&0&0\\
			0&1&0&0\\
			0&0&1&0\\
			0&0&1/d&0
		\end{smallmatrix}\!\right)\!\\
		\vtr{M}_{\text{per}}\vtr{p}&=
		\!\left(\!\begin{smallmatrix}
			x\\
			y\\
			z\\
			z/d
		\end{smallmatrix}\!\right)\!
		\shortintertext{3D coordinate}
		& d\cdot \vtr{M}_{\text{per}}\vtr{p}
	\end{align*}
\item[\lp{Mathematics of parallel projection}]
	\begin{align*}
		\vtr{M}_{\text{ort}}&=
		\!\left(\!\begin{smallmatrix}
			1&0&0&0\\
			0&1&0&0\\
			0&0&0&0\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!
	\end{align*}
\item[\lp{Clipping planes}]
	Parallel projection:\hfill
	\pgr{2-2_Transformations}{41}{-2.9}{-1.2}{0}{0.65}
	Perspective projection:\hfill
	\pgr{2-2_Transformations}{41}{0}{-1.2}{2.9}{0.65}
\item[\lp{Summary of transformations}]
	\pgr{2-2_Transformations}{42}{-2.95}{-1.5}{2.95}{1.05}
	\section{Stages of transformations}
		 Vertex $(x,y,z,1)^T$\\
	\begin{enumerate*}[label=\protect\circled{\arabic*},itemjoin=]
		\item ModelView Transform\\
			Eye Coordinates\\
		\item	Projection\\
			Clip Coordinates\\
		\item	Perspective Division\\
			Normalized Device Coordinates\\
		\item	Viewport Transform\\
			Window (Screen) Coordinates\\
	\end{enumerate*}
\item[\lp{ModelView Transform}] \hfill\\
	\emph{Stage 1:}\\
	Use Eq. \ref{eq:coordtrafo} for $\text{Model Coordinates}\mapsto\text{World Coordinates}$.
	\begin{gather*}
		\vtr{M}
		\!\left(\!\begin{smallmatrix}
			m_x\\
			m_y\\
			m_z\\
			1
		\end{smallmatrix}\!\right)\!
		=
		\!\left(\!\begin{smallmatrix}
			w_x\\
			w_y\\
			w_z\\
			1
		\end{smallmatrix}\!\right)\!
	\end{gather*}
	\emph{Stage 2:}\\
	Eye (camera) coordinates $\mapsto$ world coordinates
	\begin{align*}
		\!\left(\!\begin{smallmatrix}
			\vtr{left}&\vtr{up}&-\vtr{dir}&\vtr{eye}\\
			0&0&0&1
		\end{smallmatrix}\!\right)\!
		\!\left(\!\begin{smallmatrix}
			c_x\\
			c_y\\
			c_z\\
			1
		\end{smallmatrix}\!\right)\!
		&=
		\!\left(\!\begin{smallmatrix}
			w_x\\
			w_y\\
			w_z\\
			1
		\end{smallmatrix}\!\right)\!
	\end{align*}
	\begin{align*}
		\shortintertext{Default in OpenGL:}
		\vtr{left}&=
		{\!\left(\!\begin{smallmatrix}
			1&0&0
		\end{smallmatrix}\!\right)\!}^T&
		\vtr{up}&=
		{\!\left(\!\begin{smallmatrix}
			0&1&0
		\end{smallmatrix}\!\right)\!}^T\\
		\vtr{dir}&=
		{\!\left(\!\begin{smallmatrix}
			0&0&-1
		\end{smallmatrix}\!\right)\!}^T&
		\vtr{eye}&=
		{\!\left(\!\begin{smallmatrix}
			0&0&0
		\end{smallmatrix}\!\right)\!}^T\\
	\end{align*}
\item[\lp{Projection}] \hfill\\
	\emph{Option 1: Parallel projection}
	\pgr{2-2_Transformations}{48}{-1.45}{-1.1}{1.45}{0.3}
	\begin{lstlisting}
	glOrtho(left, right, bottom, top, near, far);
	\end{lstlisting}
	\begin{gather*}
		\!\left(\!\begin{smallmatrix}
				\frac{2}{r-l}&0&0&-\frac{r+l}{r-l}\\
				0&\frac{2}{t-b}&0&-\frac{t+b}{t-b}\\
				0&0&-\frac{2}{f-n}&-\frac{f+n}{f-n}\\
				0&0&0&1
		\end{smallmatrix}\!\right)\!
		\!\left(\!\begin{smallmatrix}
			c_x\\
			c_y\\
			c_z\\
			1
		\end{smallmatrix}\!\right)\!\\
		=
		\!\left(\!\begin{smallmatrix}
			c_x'\\
			c_y'\\
			c_z'\\
			1
		\end{smallmatrix}\!\right)\!
	\end{gather*}
	\emph{Option 2: Perspective projection}
	\pgr{2-2_Transformations}{50}{-1.4}{-1.1}{1.5}{0.3}
	\begin{lstlisting}
	glFrustum(left, right, bottom, top, near, far);
	\end{lstlisting}
	\begin{gather*}
		\!\left(\!\begin{smallmatrix}
			\frac{2n}{r-l}&0&\frac{r+l}{r-l}&0\\
			0&\frac{2n}{t-b}&\frac{t+b}{t-b}&0\\
			0&0&-\frac{f+n}{f-n}&-\frac{2fn}{f-n}\\
			0&0&-1&0
		\end{smallmatrix}\!\right)\!
		\!\left(\!\begin{smallmatrix}
			c_x\\
			c_y\\
			c_z\\
			1
		\end{smallmatrix}\!\right)\!\\
		=
		\!\left(\!\begin{smallmatrix}
			c_x'\\
			c_y'\\
			c_z'\\
			1
		\end{smallmatrix}\!\right)\!
	\end{gather*}
	Clip the points
	\begin{gather*}
		\vtr{p}=(c_x',c_y',c_z',1)
	\end{gather*}
	by comparing $c_x',c_y',c_z'$ with 1.
\item[\lp{Perspective Division}]
	\begin{gather*}
		\!\left(\!\begin{smallmatrix}
			d_x\\
			d_y\\
			d_z
		\end{smallmatrix}\!\right)\!
		=
		\!\left(\!\begin{smallmatrix}
			c_x'/(-c_z)\\
			c_y'/(-c_z)\\
			c_z'/(-c_z)
		\end{smallmatrix}\!\right)\!,
	\end{gather*}
		where $d_x,d_y$ determines coordinates on the screen and $d_z$ is used for depth tests.
	\item[\lp{Viewport Transform}]
		Normalized device coordinates (bottom left corner $(-1,-1)$, top right corner $(1,1)$) $\mapsto$ screen coordinates (bottom left corner $(o_x,o_y)$, top right corner $(o_x+w,o_y+h)$)
		\begin{gather*}
			\!\left(\!\begin{smallmatrix}
				x\\
				y\\
				z
			\end{smallmatrix}\!\right)\!
			=
			\!\left(\!\begin{smallmatrix}
				\frac{w}{2}d_x+\left( o_x+\frac{w}{2} \right)\\
				\frac{h}{2}d_y+\left( o_y+\frac{h}{2} \right)\\
				\frac{f-n}{2}d_z+\frac{f+n}{2}
			\end{smallmatrix}\!\right)\!
		\end{gather*}
		\begin{lstlisting}
		glViewport( o_x, o_y, w, h );
		glDepthRange(n, f);
		\end{lstlisting}
\end{compactdesc}
